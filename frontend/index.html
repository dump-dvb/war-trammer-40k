<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Spoon-Knife</title>
  <LINK href="styles.css" rel="stylesheet" type="text/css">
</head>

<body>
    <h1> WarTrammer 40K </h1>
    <form action="/api/start" method="get" target="engage_iframe">
        <button class="engage">Engage</button>
    </form>
    <iframe id="subframe" name="engage_iframe">
    </iframe>

    <form action="/api/line_info" method="post" id="line_data">
        <label for="line">Tram Line</label>
        <input type="number" step="1" pattern="\d+" id="inputLineNumber"/></br>
        <label for="run">Run Number</label>
        <input type="number" step="1" pattern="\d+" id="inputRunNumber"/>

        <button class="engage">Update</button>
    </form>

    <form action="/api/stop" method="get" target="disengage_iframe">
        <button class="Disengage">Disengage</button>
    </form>
    <iframe id="subframe" name="disengage_iframe">
    </iframe>

    <form action="/api/finish" method="get">
        <button class="Finsish">Finsih</button>
    </form>
    
    <a href="/result/"> Result Data </a>
    <a href="/data/"> Data </a>

    <script type="text/javascript">
        function handleSubmit(event) {
          event.preventDefault();

          const form_data = new FormData(event.target);

          var json_object = { };
          json_object["line"] = parseInt(document.getElementById("inputLineNumber").value);
          json_object["run"] = parseInt(document.getElementById("inputRunNumber").value);

          let xhr = new XMLHttpRequest(); 
          xhr.open("POST", "api/line_info");  
          xhr.setRequestHeader("Accept", "application/json"); 
          xhr.setRequestHeader("Content-Type", "application/json");  
          xhr.onload = () => console.log(xhr.responseText);  
          xhr.send(JSON.stringify(json_object));
        }

        const form = document.querySelector('#line_data');
        form.addEventListener('submit', handleSubmit);

    </script>
</body>
</html>
